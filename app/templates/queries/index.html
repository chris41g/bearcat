{% extends "layout.html" %}

{% block content %}
<h1 class="mb-4"><i class="fas fa-database me-2"></i>Database Queries</h1>

<div class="row">
    <div class="col-md-6 mb-4">
        <div class="card h-100">
            <div class="card-header bg-primary text-white">
                <h5 class="mb-0"><i class="fas fa-list-ul me-2"></i>Predefined Queries</h5>
            </div>
            <div class="card-body">
                <p>Run common, pre-configured queries to analyze your network data:</p>
                
                <div class="accordion" id="queryPreview">
                    <div class="accordion-item">
                        <h2 class="accordion-header" id="hostQueriesPreview">
                            <button class="accordion-button" type="button" data-bs-toggle="collapse" data-bs-target="#collapseHostPreview" aria-expanded="true" aria-controls="collapseHostPreview">
                                <i class="fas fa-laptop text-primary me-2"></i>Host Discovery Queries
                            </button>
                        </h2>
                        <div id="collapseHostPreview" class="accordion-collapse collapse show" aria-labelledby="hostQueriesPreview" data-bs-parent="#queryPreview">
                            <div class="accordion-body">
                                <ul class="list-group list-group-flush">
                                    <li class="list-group-item">
                                        <i class="fas fa-circle text-success me-1" style="font-size: 0.7em;"></i>
                                        All online hosts
                                    </li>
                                    <li class="list-group-item">
                                        <i class="fas fa-search text-info me-1" style="font-size: 0.7em;"></i>
                                        Search by IP, subnet, range, or wildcards
                                    </li>
                                    <li class="list-group-item">
                                        <i class="fas fa-desktop text-warning me-1" style="font-size: 0.7em;"></i>
                                        Filter by operating system
                                    </li>
                                    <li class="list-group-item">
                                        <i class="fab fa-windows text-primary me-1"></i>
                                        Windows hosts only
                                    </li>
                                    <li class="list-group-item">
                                        <i class="fab fa-linux text-success me-1"></i>
                                        Linux hosts only
                                    </li>
                                    <li class="list-group-item">
                                        <i class="fas fa-clock text-danger me-1" style="font-size: 0.7em;"></i>
                                        Recently scanned hosts
                                    </li>
                                </ul>
                            </div>
                        </div>
                    </div>
                    
                    <div class="accordion-item">
                        <h2 class="accordion-header" id="serviceQueriesPreview">
                            <button class="accordion-button collapsed" type="button" data-bs-toggle="collapse" data-bs-target="#collapseServicePreview" aria-expanded="false" aria-controls="collapseServicePreview">
                                <i class="fas fa-network-wired text-primary me-2"></i>Service & Port Queries
                            </button>
                        </h2>
                        <div id="collapseServicePreview" class="accordion-collapse collapse" aria-labelledby="serviceQueriesPreview" data-bs-parent="#queryPreview">
                            <div class="accordion-body">
                                <ul class="list-group list-group-flush">
                                    <li class="list-group-item">
                                        <i class="fas fa-door-open text-info me-1" style="font-size: 0.7em;"></i>
                                        Hosts with specific open ports
                                    </li>
                                    <li class="list-group-item">
                                        <i class="fas fa-folder-open text-success me-1" style="font-size: 0.7em;"></i>
                                        Hosts with network shares
                                    </li>
                                    <li class="list-group-item">
                                        <i class="fas fa-shield-alt text-warning me-1" style="font-size: 0.7em;"></i>
                                        Hosts with admin shares
                                    </li>
                                </ul>
                            </div>
                        </div>
                    </div>
                    
                    <div class="accordion-item">
                        <h2 class="accordion-header" id="softwareQueriesPreview">
                            <button class="accordion-button collapsed" type="button" data-bs-toggle="collapse" data-bs-target="#collapseSoftwarePreview" aria-expanded="false" aria-controls="collapseSoftwarePreview">
                                <i class="fas fa-cubes text-primary me-2"></i>Software & License Queries
                            </button>
                        </h2>
                        <div id="collapseSoftwarePreview" class="accordion-collapse collapse" aria-labelledby="softwareQueriesPreview" data-bs-parent="#queryPreview">
                            <div class="accordion-body">
                                <ul class="list-group list-group-flush">
                                    <li class="list-group-item">
                                        <i class="fas fa-cubes text-info me-1" style="font-size: 0.7em;"></i>
                                        Hosts with specific software
                                    </li>
                                    <li class="list-group-item">
                                        <i class="fas fa-key text-warning me-1" style="font-size: 0.7em;"></i>
                                        Hosts with Foxit license keys
                                    </li>
                                    <li class="list-group-item">
                                        <i class="fas fa-file-pdf text-danger me-1" style="font-size: 0.7em;"></i>
                                        Foxit installs without licenses
                                    </li>
                                    <li class="list-group-item">
                                        <i class="fas fa-file-alt text-primary me-1" style="font-size: 0.7em;"></i>
                                        All Foxit installations
                                    </li>
                                </ul>
                            </div>
                        </div>
                    </div>
                    
                    <div class="accordion-item">
                        <h2 class="accordion-header" id="scanQueriesPreview">
                            <button class="accordion-button collapsed" type="button" data-bs-toggle="collapse" data-bs-target="#collapseScanPreview" aria-expanded="false" aria-controls="collapseScanPreview">
                                <i class="fas fa-history text-primary me-2"></i>Scan History Queries
                            </button>
                        </h2>
                        <div id="collapseScanPreview" class="accordion-collapse collapse" aria-labelledby="scanQueriesPreview" data-bs-parent="#queryPreview">
                            <div class="accordion-body">
                                <ul class="list-group list-group-flush">
                                    <li class="list-group-item">
                                        <i class="fas fa-chart-line text-info me-1" style="font-size: 0.7em;"></i>
                                        Scan session history with statistics
                                    </li>
                                </ul>
                            </div>
                        </div>
                    </div>
                </div>
                
                <div class="mt-3">
                    <a href="{{ url_for('queries.predefined') }}" class="btn btn-primary">
                        <i class="fas fa-play me-2"></i>Go to Predefined Queries
                    </a>
                </div>
            </div>
        </div>
    </div>
    
    <div class="col-md-6 mb-4">
        <div class="card h-100">
            <div class="card-header text-white" style="background-color: #4A4A4A;">
                <h5 class="mb-0"><i class="fas fa-code me-2"></i>Custom SQL Queries</h5>
            </div>
            <div class="card-body">
                <p>Write your own SQL queries to extract specific information from the database:</p>
                
                <div class="alert alert-info">
                    <i class="fas fa-info-circle me-2"></i>
                    <strong>Database Schema:</strong> The database contains tables for hosts, services, shares, system info, installed software, running services, and scan sessions.
                </div>
                
                <h6 class="mt-3">Available Tables:</h6>
                <div class="table-responsive">
                    <table class="table table-sm">
                        <thead>
                            <tr>
                                <th>Table</th>
                                <th>Description</th>
                            </tr>
                        </thead>
                        <tbody>
                            <tr>
                                <td><code>hosts</code></td>
                                <td>Host information (IP, hostname, OS, status)</td>
                            </tr>
                            <tr>
                                <td><code>services</code></td>
                                <td>Open ports and services</td>
                            </tr>
                            <tr>
                                <td><code>shares</code></td>
                                <td>Network shares</td>
                            </tr>
                            <tr>
                                <td><code>system_info</code></td>
                                <td>System information and license keys</td>
                            </tr>
                            <tr>
                                <td><code>installed_software</code></td>
                                <td>Installed software</td>
                            </tr>
                            <tr>
                                <td><code>running_services</code></td>
                                <td>Running Windows services</td>
                            </tr>
                            <tr>
                                <td><code>scan_sessions</code></td>
                                <td>Scan session history</td>
                            </tr>
                        </tbody>
                    </table>
                </div>
                
                <p><strong>Features include:</strong></p>
                <ul>
                    <li>Direct SQL access to the database</li>
                    <li>Save frequently used queries</li>
                    <li>Export results to CSV</li>
                    <li>Built-in protection against harmful operations</li>
                </ul>
                
                <div class="alert alert-warning">
                    <i class="fas fa-exclamation-triangle me-2"></i>
                    <strong>Note:</strong> For security reasons, only SELECT queries are allowed. Operations like INSERT, UPDATE, DELETE, and DROP are blocked.
                </div>
                
                <div class="mt-3">
                    <a href="{{ url_for('queries.custom') }}" class="btn" style="background-color: #4A4A4A; color: white;">
                        <i class="fas fa-play me-2"></i>Go to Custom SQL Queries
                    </a>
                </div>
            </div>
        </div>
    </div>
</div>

<!-- Quick Start Examples -->
<div class="row">
    <div class="col-12">
        <div class="card">
            <div class="card-header bg-success text-white">
                <h5 class="mb-0"><i class="fas fa-rocket me-2"></i>Quick Start Examples</h5>
            </div>
            <div class="card-body">
                <div class="row">
                    <div class="col-md-4 mb-3">
                        <div class="card bg-light">
                            <div class="card-body">
                                <h6 class="card-title">
                                    <i class="fas fa-search text-primary me-1"></i>
                                    Find Specific Hosts
                                </h6>
                                <p class="card-text small">Use the "Search by IP/Subnet/Range" query to find:</p>
                                <ul class="small">
                                    <li><code>192.168.1.*</code> - All hosts in subnet</li>
                                    <li><code>10.0.0.0/8</code> - CIDR notation</li>
                                    <li><code>172.16.1.1-172.16.1.50</code> - IP range</li>
                                </ul>
                            </div>
                        </div>
                    </div>
                    
                    <div class="col-md-4 mb-3">
                        <div class="card bg-light">
                            <div class="card-body">
                                <h6 class="card-title">
                                    <i class="fas fa-network-wired text-info me-1"></i>
                                    Find Open Ports
                                </h6>
                                <p class="card-text small">Use "Hosts with Specific Port" to find:</p>
                                <ul class="small">
                                    <li>Port 22 - SSH servers</li>
                                    <li>Port 3389 - RDP servers</li>
                                    <li>Port 445 - SMB/CIFS shares</li>
                                </ul>
                            </div>
                        </div>
                    </div>
                    
                    <div class="col-md-4 mb-3">
                        <div class="card bg-light">
                            <div class="card-body">
                                <h6 class="card-title">
                                    <i class="fas fa-shield-alt text-warning me-1"></i>
                                    Security Queries
                                </h6>
                                <p class="card-text small">Find potential security issues:</p>
                                <ul class="small">
                                    <li>Hosts with admin shares</li>
                                    <li>Windows hosts without patches</li>
                                    <li>Open administrative ports</li>
                                </ul>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>
{% endblock %}
